# 0 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
# 1 "/home/chandu/sdk/bl602_iot_sdk/customer_app/suas_app_pqkem_gateway/build_out/easyflash4//"
# 0 "<built-in>"
# 0 "<command-line>"
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
# 29 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 1 3
# 10 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/_ansi.h" 1 3
# 10 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/_ansi.h" 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/newlib.h" 1 3
# 10 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/newlib.h" 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/_newlib_version.h" 1 3
# 11 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/newlib.h" 2 3
# 11 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/_ansi.h" 2 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/config.h" 1 3



# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/ieeefp.h" 1 3
# 5 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/config.h" 2 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/features.h" 1 3
# 6 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/config.h" 2 3
# 12 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/_ansi.h" 2 3
# 11 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 2 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 1 3
# 13 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/_ansi.h" 1 3
# 14 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 2 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 1 3 4
# 160 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 3 4

# 160 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 3 4
typedef int ptrdiff_t;
# 229 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 3 4
typedef unsigned int size_t;
# 344 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 3 4
typedef int wchar_t;
# 440 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 3 4
typedef struct {
  long long __max_align_ll __attribute__((__aligned__(__alignof__(long long))));
  long double __max_align_ld __attribute__((__aligned__(__alignof__(long double))));
# 451 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 3 4
} max_align_t;
# 465 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 3 4
  typedef __typeof__(nullptr) nullptr_t;
# 15 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 2 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/cdefs.h" 1 3
# 45 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/cdefs.h" 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 1 3
# 41 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 3
typedef signed char __int8_t;

typedef unsigned char __uint8_t;
# 55 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 3
typedef short int __int16_t;

typedef short unsigned int __uint16_t;
# 77 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 3
typedef long int __int32_t;

typedef long unsigned int __uint32_t;
# 103 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 3
typedef long long int __int64_t;

typedef long long unsigned int __uint64_t;
# 134 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 3
typedef signed char __int_least8_t;

typedef unsigned char __uint_least8_t;
# 160 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 3
typedef short int __int_least16_t;

typedef short unsigned int __uint_least16_t;
# 182 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 3
typedef long int __int_least32_t;

typedef long unsigned int __uint_least32_t;
# 200 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 3
typedef long long int __int_least64_t;

typedef long long unsigned int __uint_least64_t;
# 214 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_default_types.h" 3
typedef long long int __intmax_t;







typedef long long unsigned int __uintmax_t;







typedef int __intptr_t;

typedef unsigned int __uintptr_t;
# 46 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/cdefs.h" 2 3

# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 1 3 4
# 48 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/cdefs.h" 2 3
# 16 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 2 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_types.h" 1 3
# 24 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_types.h" 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 1 3 4
# 374 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 3 4
typedef unsigned int wint_t;
# 25 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_types.h" 2 3


# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/machine/_types.h" 1 3
# 28 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_types.h" 2 3


typedef long __blkcnt_t;



typedef long __blksize_t;



typedef __uint64_t __fsblkcnt_t;



typedef __uint32_t __fsfilcnt_t;



typedef long _off_t;





typedef int __pid_t;



typedef short __dev_t;



typedef unsigned short __uid_t;


typedef unsigned short __gid_t;



typedef __uint32_t __id_t;







typedef unsigned short __ino_t;
# 90 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_types.h" 3
typedef __uint32_t __mode_t;





__extension__ typedef long long _off64_t;





typedef _off_t __off_t;


typedef _off64_t __loff_t;


typedef long __key_t;







typedef long _fpos_t;
# 131 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_types.h" 3
typedef unsigned int __size_t;
# 147 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_types.h" 3
typedef signed int _ssize_t;
# 158 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_types.h" 3
typedef _ssize_t __ssize_t;



typedef struct
{
  int __count;
  union
  {
    wint_t __wch;
    unsigned char __wchb[4];
  } __value;
} _mbstate_t;




typedef void *_iconv_t;






typedef unsigned long __clock_t;






typedef __int_least64_t __time_t;





typedef unsigned long __clockid_t;


typedef long __daddr_t;



typedef unsigned long __timer_t;


typedef __uint8_t __sa_family_t;



typedef __uint32_t __socklen_t;


typedef int __nl_item;
typedef unsigned short __nlink_t;
typedef long __suseconds_t;
typedef unsigned long __useconds_t;







typedef __builtin_va_list __va_list;
# 17 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 2 3






typedef unsigned long __ULong;
# 35 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/lock.h" 1 3
# 11 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/lock.h" 3
typedef int _LOCK_T;
typedef int _LOCK_RECURSIVE_T;
# 36 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 2 3
typedef _LOCK_RECURSIVE_T _flock_t;







struct _reent;

struct __locale_t;






struct _Bigint
{
  struct _Bigint *_next;
  int _k, _maxwds, _sign, _wds;
  __ULong _x[1];
};


struct __tm
{
  int __tm_sec;
  int __tm_min;
  int __tm_hour;
  int __tm_mday;
  int __tm_mon;
  int __tm_year;
  int __tm_wday;
  int __tm_yday;
  int __tm_isdst;
};







struct _on_exit_args {
 void * _fnargs[32];
 void * _dso_handle[32];

 __ULong _fntypes;


 __ULong _is_cxa;
};
# 99 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
struct _atexit {
 struct _atexit *_next;
 int _ind;

 void (*_fns[32])(void);
        struct _on_exit_args _on_exit_args;
};
# 116 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
struct __sbuf {
 unsigned char *_base;
 int _size;
};
# 153 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
struct __sFILE {
  unsigned char *_p;
  int _r;
  int _w;
  short _flags;
  short _file;
  struct __sbuf _bf;
  int _lbfsize;






  void * _cookie;

  _ssize_t (*_read) (struct _reent *, void *,
        char *, int);
  _ssize_t (*_write) (struct _reent *, void *,
         const char *,
         int);
  _fpos_t (*_seek) (struct _reent *, void *, _fpos_t, int);
  int (*_close) (struct _reent *, void *);


  struct __sbuf _ub;
  unsigned char *_up;
  int _ur;


  unsigned char _ubuf[3];
  unsigned char _nbuf[1];


  struct __sbuf _lb;


  int _blksize;
  _off_t _offset;


  struct _reent *_data;



  _flock_t _lock;

  _mbstate_t _mbstate;
  int _flags2;
};
# 270 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
typedef struct __sFILE __FILE;



extern __FILE __sf[3];

struct _glue
{
  struct _glue *_next;
  int _niobs;
  __FILE *_iobs;
};

extern struct _glue __sglue;
# 306 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
struct _rand48 {
  unsigned short _seed[3];
  unsigned short _mult[3];
  unsigned short _add;




};
# 568 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
struct _reent
{
  int _errno;




  __FILE *_stdin, *_stdout, *_stderr;

  int _inc;
  char _emergency[25];




  struct __locale_t *_locale;





  void (*__cleanup) (struct _reent *);


  struct _Bigint *_result;
  int _result_k;
  struct _Bigint *_p5s;
  struct _Bigint **_freelist;


  int _cvtlen;
  char *_cvtbuf;

  union
    {
      struct
        {



          char * _strtok_last;
          char _asctime_buf[26];
          struct __tm _localtime_buf;
          int _gamma_signgam;
          __extension__ unsigned long long _rand_next;
          struct _rand48 _r48;
          _mbstate_t _mblen_state;
          _mbstate_t _mbtowc_state;
          _mbstate_t _wctomb_state;
          char _l64a_buf[8];
          char _signal_buf[24];
          int _getdate_err;
          _mbstate_t _mbrlen_state;
          _mbstate_t _mbrtowc_state;
          _mbstate_t _mbsrtowcs_state;
          _mbstate_t _wcrtomb_state;
          _mbstate_t _wcsrtombs_state;
   int _h_errno;
# 634 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
        } _reent;







    } _new;







  void (**_sig_func)(int);
};
# 782 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
extern struct _reent *_impure_ptr ;





extern struct _reent _impure_data ;
# 900 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/reent.h" 3
extern struct _atexit *__atexit;
extern struct _atexit __atexit0;

extern void (*__stdio_exit_handler) (void);

void _reclaim_reent (struct _reent *);

extern int _fwalk_sglue (struct _reent *, int (*)(struct _reent *, __FILE *),
    struct _glue *);
# 12 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 2 3





# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 1 3 4
# 18 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 2 3


# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_locale.h" 1 3
# 9 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/_locale.h" 3
struct __locale_t;
typedef struct __locale_t *locale_t;
# 21 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 2 3



# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/strings.h" 1 3
# 44 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/strings.h" 3


int bcmp(const void *, const void *, size_t) __attribute__((__pure__));
void bcopy(const void *, void *, size_t);
void bzero(void *, size_t);


void explicit_bzero(void *, size_t);


int ffs(int) __attribute__((__const__));


int ffsl(long) __attribute__((__const__));
int ffsll(long long) __attribute__((__const__));
int fls(int) __attribute__((__const__));
int flsl(long) __attribute__((__const__));
int flsll(long long) __attribute__((__const__));


char *index(const char *, int) __attribute__((__pure__));
char *rindex(const char *, int) __attribute__((__pure__));

int strcasecmp(const char *, const char *) __attribute__((__pure__));
int strncasecmp(const char *, const char *, size_t) __attribute__((__pure__));


int strcasecmp_l (const char *, const char *, locale_t);
int strncasecmp_l (const char *, const char *, size_t, locale_t);


# 25 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 2 3




void * memchr (const void *, int, size_t);
int memcmp (const void *, const void *, size_t);
void * memcpy (void *restrict, const void *restrict, size_t);
void * memmove (void *, const void *, size_t);
void * memset (void *, int, size_t);
char *strcat (char *restrict, const char *restrict);
char *strchr (const char *, int);
int strcmp (const char *, const char *);
int strcoll (const char *, const char *);
char *strcpy (char *restrict, const char *restrict);
size_t strcspn (const char *, const char *);
char *strerror (int);
size_t strlen (const char *);
char *strncat (char *restrict, const char *restrict, size_t);
int strncmp (const char *, const char *, size_t);
char *strncpy (char *restrict, const char *restrict, size_t);
char *strpbrk (const char *, const char *);
char *strrchr (const char *, int);
size_t strspn (const char *, const char *);
char *strstr (const char *, const char *);

char *strtok (char *restrict, const char *restrict);

size_t strxfrm (char *restrict, const char *restrict, size_t);


int strcoll_l (const char *, const char *, locale_t);
char *strerror_l (int, locale_t);
size_t strxfrm_l (char *restrict, const char *restrict, size_t, locale_t);


char *strtok_r (char *restrict, const char *restrict, char **restrict);


int timingsafe_bcmp (const void *, const void *, size_t);
int timingsafe_memcmp (const void *, const void *, size_t);


void * memccpy (void *restrict, const void *restrict, int, size_t);
# 76 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 3
char *stpcpy (char *restrict, const char *restrict);
char *stpncpy (char *restrict, const char *restrict, size_t);






char *strdup (const char *) __attribute__((__malloc__)) __attribute__((__warn_unused_result__));

char *_strdup_r (struct _reent *, const char *);

char *strndup (const char *, size_t) __attribute__((__malloc__)) __attribute__((__warn_unused_result__));

char *_strndup_r (struct _reent *, const char *, size_t);
# 100 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 3
int strerror_r (int, char *, size_t)

             __asm__ ("" "__xpg_strerror_r")

  ;







char * _strerror_r (struct _reent *, int, int, int *);


size_t strlcat (char *, const char *, size_t);
size_t strlcpy (char *, const char *, size_t);


size_t strnlen (const char *, size_t);


char *strsep (char **, const char *);


char *strnstr(const char *, const char *, size_t) __attribute__((__pure__));



char *strlwr (char *);
char *strupr (char *);



char *strsignal (int __signo);
# 175 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/string.h" 1 3
# 15 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/string.h" 3
static __inline unsigned long __libc_detect_null(unsigned long w)
{
  unsigned long mask = 0x7f7f7f7f;
  if (sizeof (long) == 8)
    mask = ((mask << 16) << 16) | mask;
  return ~(((w & mask) + mask) | w | mask);
}
# 176 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/string.h" 2 3


# 30 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 2
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/easyflash.h" 1
# 33 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/easyflash.h"
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stdint.h" 1 3 4
# 14 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stdint.h" 3 4
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stdint-gcc.h" 1 3 4
# 34 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stdint-gcc.h" 3 4
typedef signed char int8_t;


typedef short int int16_t;


typedef long int int32_t;


typedef long long int int64_t;


typedef unsigned char uint8_t;


typedef short unsigned int uint16_t;


typedef long unsigned int uint32_t;


typedef long long unsigned int uint64_t;




typedef signed char int_least8_t;
typedef short int int_least16_t;
typedef long int int_least32_t;
typedef long long int int_least64_t;
typedef unsigned char uint_least8_t;
typedef short unsigned int uint_least16_t;
typedef long unsigned int uint_least32_t;
typedef long long unsigned int uint_least64_t;



typedef int int_fast8_t;
typedef int int_fast16_t;
typedef int int_fast32_t;
typedef long long int int_fast64_t;
typedef unsigned int uint_fast8_t;
typedef unsigned int uint_fast16_t;
typedef unsigned int uint_fast32_t;
typedef long long unsigned int uint_fast64_t;




typedef int intptr_t;


typedef unsigned int uintptr_t;




typedef long long int intmax_t;
typedef long long unsigned int uintmax_t;
# 15 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stdint.h" 2 3 4
# 34 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/easyflash.h" 2
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 1 3 4
# 35 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/easyflash.h" 2
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stdbool.h" 1 3 4
# 36 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/easyflash.h" 2
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/ef_cfg.h" 1
# 37 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/easyflash.h" 2
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/ef_def.h" 1
# 73 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/ef_def.h"

# 73 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/ef_def.h"
typedef struct _ef_env {
    char *key;
    void *value;
    size_t value_len;
} ef_env, *ef_env_t;


typedef enum {
    EF_NO_ERR,
    EF_ERASE_ERR,
    EF_READ_ERR,
    EF_WRITE_ERR,
    EF_ENV_NAME_ERR,
    EF_ENV_NAME_EXIST,
    EF_ENV_FULL,
    EF_ENV_INIT_FAILED,
    EF_ENV_ARG_ERR,
} EfErrCode;


typedef enum {
    EF_SECTOR_EMPTY,
    EF_SECTOR_USING,
    EF_SECTOR_FULL,
} EfSecrorStatus;

enum env_status {
    ENV_UNUSED,
    ENV_PRE_WRITE,
    ENV_WRITE,
    ENV_PRE_DELETE,
    ENV_DELETED,
    ENV_ERR_HDR,
    ENV_STATUS_NUM,
};
typedef enum env_status env_status_t;

struct env_node_obj {
    env_status_t status;
    bool crc_is_ok;
    uint8_t name_len;
    uint32_t magic;
    uint32_t len;
    uint32_t value_len;
    char name[(64)];
    struct {
        uint32_t start;
        uint32_t value;
    } addr;
};
typedef struct env_node_obj *env_node_obj_t;
# 38 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/easyflash.h" 2






EfErrCode easyflash_init(void);



size_t ef_get_env_blob(const char *key, void *value_buf, size_t buf_len, size_t *saved_value_len);
bool ef_get_env_obj(const char *key, env_node_obj_t env);
size_t ef_read_env_value(env_node_obj_t env, uint8_t *value_buf, size_t buf_len);
EfErrCode ef_set_env_blob(const char *key, const void *value_buf, size_t buf_len);


EfErrCode ef_load_env(void);
void ef_print_env(void);
char *ef_get_env(const char *key);
EfErrCode ef_set_env(const char *key, const char *value);
EfErrCode ef_del_env(const char *key);
EfErrCode ef_save_env(void);
EfErrCode ef_env_set_default(void);
size_t ef_get_env_write_bytes(void);
EfErrCode ef_set_and_save_env(const char *key, const char *value);
EfErrCode ef_del_and_save_env(const char *key);
# 96 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/inc/easyflash.h"
uint32_t ef_calc_crc32(uint32_t crc, const void *buf, size_t size);


EfErrCode ef_port_read(uint32_t addr, uint32_t *buf, size_t size);
EfErrCode ef_port_erase(uint32_t addr, size_t size);
EfErrCode ef_port_write(uint32_t addr, const uint32_t *buf, size_t size);
void ef_port_env_lock(void);
void ef_port_env_unlock(void);
void ef_log_debug(const char *file, const long line, const char *format, ...);
void ef_log_info(const char *format, ...);
void ef_print(const char *format, ...);

int easyflash_cli_init(void);
# 31 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 2
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/utils/include/utils_log.h" 1
# 34 "/home/chandu/sdk/bl602_iot_sdk/components/utils/include/utils_log.h"
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 1 3
# 36 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 1 3 4
# 37 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 2 3



# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stdarg.h" 1 3 4
# 40 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stdarg.h" 3 4

# 40 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stdarg.h" 3 4
typedef __builtin_va_list __gnuc_va_list;
# 41 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 2 3





typedef __gnuc_va_list va_list;
# 63 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3



typedef __FILE FILE;



typedef _fpos_t fpos_t;





typedef __off_t off_t;




typedef _ssize_t ssize_t;



# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/sys/stdio.h" 1 3
# 86 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 2 3
# 187 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
char * ctermid (char *);




FILE * tmpfile (void);
char * tmpnam (char *);

char * tempnam (const char *, const char *) __attribute__((__malloc__)) __attribute__((__warn_unused_result__));

int fclose (FILE *);
int fflush (FILE *);
FILE * freopen (const char *restrict, const char *restrict, FILE *restrict);
void setbuf (FILE *restrict, char *restrict);
int setvbuf (FILE *restrict, char *restrict, int, size_t);
int fprintf (FILE *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 2, 3)));
int fscanf (FILE *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__scanf__, 2, 3)));
int printf (const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 1, 2)));
int scanf (const char *restrict, ...)
               __attribute__ ((__format__ (__scanf__, 1, 2)));
int sscanf (const char *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__scanf__, 2, 3)));
int vfprintf (FILE *restrict, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 2, 0)));
int vprintf (const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 1, 0)));
int vsprintf (char *restrict, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 2, 0)));
int fgetc (FILE *);
char * fgets (char *restrict, int, FILE *restrict);
int fputc (int, FILE *);
int fputs (const char *restrict, FILE *restrict);
int getc (FILE *);
int getchar (void);
char * gets (char *);
int putc (int, FILE *);
int putchar (int);
int puts (const char *);
int ungetc (int, FILE *);
size_t fread (void *restrict, size_t _size, size_t _n, FILE *restrict);
size_t fwrite (const void *restrict , size_t _size, size_t _n, FILE *);



int fgetpos (FILE *restrict, fpos_t *restrict);

int fseek (FILE *, long, int);



int fsetpos (FILE *, const fpos_t *);

long ftell ( FILE *);
void rewind (FILE *);
void clearerr (FILE *);
int feof (FILE *);
int ferror (FILE *);
void perror (const char *);

FILE * fopen (const char *restrict _name, const char *restrict _type);
int sprintf (char *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 2, 3)));
int remove (const char *);
int rename (const char *, const char *);
# 263 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
int fseeko (FILE *, off_t, int);
off_t ftello (FILE *);







int snprintf (char *restrict, size_t, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
int vsnprintf (char *restrict, size_t, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
int vfscanf (FILE *restrict, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 2, 0)));
int vscanf (const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 1, 0)));
int vsscanf (const char *restrict, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 2, 0)));
# 290 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
int asiprintf (char **, const char *, ...)
               __attribute__ ((__format__ (__printf__, 2, 3)));
char * asniprintf (char *, size_t *, const char *, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
char * asnprintf (char *restrict, size_t *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));

int diprintf (int, const char *, ...)
               __attribute__ ((__format__ (__printf__, 2, 3)));

int fiprintf (FILE *, const char *, ...)
               __attribute__ ((__format__ (__printf__, 2, 3)));
int fiscanf (FILE *, const char *, ...)
               __attribute__ ((__format__ (__scanf__, 2, 3)));
int iprintf (const char *, ...)
               __attribute__ ((__format__ (__printf__, 1, 2)));
int iscanf (const char *, ...)
               __attribute__ ((__format__ (__scanf__, 1, 2)));
int siprintf (char *, const char *, ...)
               __attribute__ ((__format__ (__printf__, 2, 3)));
int siscanf (const char *, const char *, ...)
               __attribute__ ((__format__ (__scanf__, 2, 3)));
int sniprintf (char *, size_t, const char *, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
int vasiprintf (char **, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 2, 0)));
char * vasniprintf (char *, size_t *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
char * vasnprintf (char *, size_t *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
int vdiprintf (int, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 2, 0)));
int vfiprintf (FILE *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 2, 0)));
int vfiscanf (FILE *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 2, 0)));
int viprintf (const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 1, 0)));
int viscanf (const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 1, 0)));
int vsiprintf (char *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 2, 0)));
int vsiscanf (const char *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 2, 0)));
int vsniprintf (char *, size_t, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
# 345 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
FILE * fdopen (int, const char *);

int fileno (FILE *);


int pclose (FILE *);
FILE * popen (const char *, const char *);



void setbuffer (FILE *, char *, int);
int setlinebuf (FILE *);



int getw (FILE *);
int putw (int, FILE *);


int getc_unlocked (FILE *);
int getchar_unlocked (void);
void flockfile (FILE *);
int ftrylockfile (FILE *);
void funlockfile (FILE *);
int putc_unlocked (int, FILE *);
int putchar_unlocked (int);
# 380 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
int dprintf (int, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 2, 3)));

FILE * fmemopen (void *restrict, size_t, const char *restrict);


FILE * open_memstream (char **, size_t *);
int vdprintf (int, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 2, 0)));



int renameat (int, const char *, int, const char *);
# 402 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
int _asiprintf_r (struct _reent *, char **, const char *, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
char * _asniprintf_r (struct _reent *, char *, size_t *, const char *, ...)
               __attribute__ ((__format__ (__printf__, 4, 5)));
char * _asnprintf_r (struct _reent *, char *restrict, size_t *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 4, 5)));
int _asprintf_r (struct _reent *, char **restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
int _diprintf_r (struct _reent *, int, const char *, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
int _dprintf_r (struct _reent *, int, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
int _fclose_r (struct _reent *, FILE *);
int _fcloseall_r (struct _reent *);
FILE * _fdopen_r (struct _reent *, int, const char *);
int _fflush_r (struct _reent *, FILE *);
int _fgetc_r (struct _reent *, FILE *);
int _fgetc_unlocked_r (struct _reent *, FILE *);
char * _fgets_r (struct _reent *, char *restrict, int, FILE *restrict);
char * _fgets_unlocked_r (struct _reent *, char *restrict, int, FILE *restrict);




int _fgetpos_r (struct _reent *, FILE *, fpos_t *);
int _fsetpos_r (struct _reent *, FILE *, const fpos_t *);

int _fiprintf_r (struct _reent *, FILE *, const char *, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
int _fiscanf_r (struct _reent *, FILE *, const char *, ...)
               __attribute__ ((__format__ (__scanf__, 3, 4)));
FILE * _fmemopen_r (struct _reent *, void *restrict, size_t, const char *restrict);
FILE * _fopen_r (struct _reent *, const char *restrict, const char *restrict);
FILE * _freopen_r (struct _reent *, const char *restrict, const char *restrict, FILE *restrict);
int _fprintf_r (struct _reent *, FILE *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
int _fpurge_r (struct _reent *, FILE *);
int _fputc_r (struct _reent *, int, FILE *);
int _fputc_unlocked_r (struct _reent *, int, FILE *);
int _fputs_r (struct _reent *, const char *restrict, FILE *restrict);
int _fputs_unlocked_r (struct _reent *, const char *restrict, FILE *restrict);
size_t _fread_r (struct _reent *, void *restrict, size_t _size, size_t _n, FILE *restrict);
size_t _fread_unlocked_r (struct _reent *, void *restrict, size_t _size, size_t _n, FILE *restrict);
int _fscanf_r (struct _reent *, FILE *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__scanf__, 3, 4)));
int _fseek_r (struct _reent *, FILE *, long, int);
int _fseeko_r (struct _reent *, FILE *, _off_t, int);
long _ftell_r (struct _reent *, FILE *);
_off_t _ftello_r (struct _reent *, FILE *);
void _rewind_r (struct _reent *, FILE *);
size_t _fwrite_r (struct _reent *, const void *restrict, size_t _size, size_t _n, FILE *restrict);
size_t _fwrite_unlocked_r (struct _reent *, const void *restrict, size_t _size, size_t _n, FILE *restrict);
int _getc_r (struct _reent *, FILE *);
int _getc_unlocked_r (struct _reent *, FILE *);
int _getchar_r (struct _reent *);
int _getchar_unlocked_r (struct _reent *);
char * _gets_r (struct _reent *, char *);
int _iprintf_r (struct _reent *, const char *, ...)
               __attribute__ ((__format__ (__printf__, 2, 3)));
int _iscanf_r (struct _reent *, const char *, ...)
               __attribute__ ((__format__ (__scanf__, 2, 3)));
FILE * _open_memstream_r (struct _reent *, char **, size_t *);
void _perror_r (struct _reent *, const char *);
int _printf_r (struct _reent *, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 2, 3)));
int _putc_r (struct _reent *, int, FILE *);
int _putc_unlocked_r (struct _reent *, int, FILE *);
int _putchar_unlocked_r (struct _reent *, int);
int _putchar_r (struct _reent *, int);
int _puts_r (struct _reent *, const char *);
int _remove_r (struct _reent *, const char *);
int _rename_r (struct _reent *,
      const char *_old, const char *_new);
int _scanf_r (struct _reent *, const char *restrict, ...)
               __attribute__ ((__format__ (__scanf__, 2, 3)));
int _siprintf_r (struct _reent *, char *, const char *, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
int _siscanf_r (struct _reent *, const char *, const char *, ...)
               __attribute__ ((__format__ (__scanf__, 3, 4)));
int _sniprintf_r (struct _reent *, char *, size_t, const char *, ...)
               __attribute__ ((__format__ (__printf__, 4, 5)));
int _snprintf_r (struct _reent *, char *restrict, size_t, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 4, 5)));
int _sprintf_r (struct _reent *, char *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__printf__, 3, 4)));
int _sscanf_r (struct _reent *, const char *restrict, const char *restrict, ...)
               __attribute__ ((__format__ (__scanf__, 3, 4)));
char * _tempnam_r (struct _reent *, const char *, const char *);
FILE * _tmpfile_r (struct _reent *);
char * _tmpnam_r (struct _reent *, char *);
int _ungetc_r (struct _reent *, int, FILE *);
int _vasiprintf_r (struct _reent *, char **, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
char * _vasniprintf_r (struct _reent*, char *, size_t *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 4, 0)));
char * _vasnprintf_r (struct _reent*, char *, size_t *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 4, 0)));
int _vasprintf_r (struct _reent *, char **, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
int _vdiprintf_r (struct _reent *, int, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
int _vdprintf_r (struct _reent *, int, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
int _vfiprintf_r (struct _reent *, FILE *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
int _vfiscanf_r (struct _reent *, FILE *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 3, 0)));
int _vfprintf_r (struct _reent *, FILE *restrict, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
int _vfscanf_r (struct _reent *, FILE *restrict, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 3, 0)));
int _viprintf_r (struct _reent *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 2, 0)));
int _viscanf_r (struct _reent *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 2, 0)));
int _vprintf_r (struct _reent *, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 2, 0)));
int _vscanf_r (struct _reent *, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 2, 0)));
int _vsiprintf_r (struct _reent *, char *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
int _vsiscanf_r (struct _reent *, const char *, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 3, 0)));
int _vsniprintf_r (struct _reent *, char *, size_t, const char *, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 4, 0)));
int _vsnprintf_r (struct _reent *, char *restrict, size_t, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 4, 0)));
int _vsprintf_r (struct _reent *, char *restrict, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__printf__, 3, 0)));
int _vsscanf_r (struct _reent *, const char *restrict, const char *restrict, __gnuc_va_list)
               __attribute__ ((__format__ (__scanf__, 3, 0)));



int fpurge (FILE *);
ssize_t __getdelim (char **, size_t *, int, FILE *);
ssize_t __getline (char **, size_t *, FILE *);


void clearerr_unlocked (FILE *);
int feof_unlocked (FILE *);
int ferror_unlocked (FILE *);
int fileno_unlocked (FILE *);
int fflush_unlocked (FILE *);
int fgetc_unlocked (FILE *);
int fputc_unlocked (int, FILE *);
size_t fread_unlocked (void *restrict, size_t _size, size_t _n, FILE *restrict);
size_t fwrite_unlocked (const void *restrict , size_t _size, size_t _n, FILE *);
# 583 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
int __srget_r (struct _reent *, FILE *);
int __swbuf_r (struct _reent *, int, FILE *);
# 607 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
FILE *funopen (const void *__cookie,
  int (*__readfn)(void *__cookie, char *__buf,
    int __n),
  int (*__writefn)(void *__cookie, const char *__buf,
     int __n),
  fpos_t (*__seekfn)(void *__cookie, fpos_t __off, int __whence),
  int (*__closefn)(void *__cookie));
FILE *_funopen_r (struct _reent *, const void *__cookie,
  int (*__readfn)(void *__cookie, char *__buf,
    int __n),
  int (*__writefn)(void *__cookie, const char *__buf,
     int __n),
  fpos_t (*__seekfn)(void *__cookie, fpos_t __off, int __whence),
  int (*__closefn)(void *__cookie));
# 691 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
static __inline__ int __sputc_r(struct _reent *_ptr, int _c, FILE *_p) {




 if (--_p->_w >= 0 || (_p->_w >= _p->_lbfsize && (char)_c != '\n'))
  return (*_p->_p++ = _c);
 else
  return (__swbuf_r(_ptr, _c, _p));
}
# 745 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3
static __inline int
_getchar_unlocked(void)
{
 struct _reent *_ptr;

 _ptr = _impure_ptr;
 return ((--(((_ptr)->_stdin))->_r < 0 ? __srget_r(_ptr, ((_ptr)->_stdin)) : (int)(*(((_ptr)->_stdin))->_p++)));
}

static __inline int
_putchar_unlocked(int _c)
{
 struct _reent *_ptr;

 _ptr = _impure_ptr;
 return (__sputc_r(_ptr, _c, ((_ptr)->_stdout)));
}
# 801 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/riscv32-unknown-elf/include/stdio.h" 3

# 35 "/home/chandu/sdk/bl602_iot_sdk/components/utils/include/utils_log.h" 2




# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h" 1
# 34 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
# 1 "/home/chandu/sdk/bl602_iot_sdk/toolchain/compiler/lib/gcc/riscv32-unknown-elf/15.1.0/include/stddef.h" 1 3 4
# 35 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h" 2
# 56 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOSConfig.h" 1
# 74 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOSConfig.h"
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/platform.h" 1
# 127 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/platform.h"

# 127 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/platform.h"
unsigned long get_cpu_freq(void);
unsigned long get_timer_freq(void);
uint64_t get_timer_value(void);
# 75 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOSConfig.h" 2
# 151 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOSConfig.h"
void vAssertCalled( void );
# 57 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h" 2


# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/projdefs.h" 1
# 35 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/projdefs.h"
typedef void (*TaskFunction_t)( void * );
# 60 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h" 2


# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/portable.h" 1
# 45 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/portable.h"
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/deprecated_definitions.h" 1
# 46 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/portable.h" 2






# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/portable/GCC/RISC-V/portmacro.h" 1
# 62 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/portable/GCC/RISC-V/portmacro.h"
typedef uint32_t StackType_t;
typedef int32_t BaseType_t;
typedef uint32_t UBaseType_t;
typedef uint32_t TickType_t;
# 92 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/portable/GCC/RISC-V/portmacro.h"
extern BaseType_t TrapNetCounter;
extern void vTaskSwitchContext( void );
# 102 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/portable/GCC/RISC-V/portmacro.h"
extern void vTaskEnterCritical( void );
extern void vTaskExitCritical( void );
# 179 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/portable/GCC/RISC-V/portmacro.h"
inline __attribute__(( always_inline)) static BaseType_t xPortIsInsideInterrupt( void )
{
    return TrapNetCounter ? 1 : 0;
}
# 53 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/portable.h" 2
# 99 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/portable.h"
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/mpu_wrappers.h" 1
# 100 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/portable.h" 2
# 117 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/portable.h"
  StackType_t *pxPortInitialiseStack( StackType_t *pxTopOfStack, TaskFunction_t pxCode, void *pvParameters ) ;





typedef struct HeapRegion
{
 uint8_t *pucStartAddress;
 size_t xSizeInBytes;
} HeapRegion_t;


typedef struct xHeapStats
{
 size_t xAvailableHeapSpaceInBytes;
 size_t xSizeOfLargestFreeBlockInBytes;
 size_t xSizeOfSmallestFreeBlockInBytes;
 size_t xNumberOfFreeBlocks;
 size_t xMinimumEverFreeBytesRemaining;
 size_t xNumberOfSuccessfulAllocations;
 size_t xNumberOfSuccessfulFrees;
} HeapStats_t;
# 152 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/portable.h"
void vPortDefineHeapRegions( const HeapRegion_t * const pxHeapRegions ) ;





void vPortGetHeapStats( HeapStats_t *pxHeapStats );




void *pvPortMalloc( size_t xSize ) ;
void vPortFree( void *pv ) ;
void *pvPortRealloc (void *ptr, size_t size ) ;
void vPortInitialiseBlocks( void ) ;
size_t xPortGetFreeHeapSize( void ) ;
size_t xPortGetMinimumEverFreeHeapSize( void ) ;





BaseType_t xPortStartScheduler( void ) ;






void vPortEndScheduler( void ) ;
# 63 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h" 2
# 1061 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
struct xSTATIC_LIST_ITEM
{



 TickType_t xDummy2;
 void *pvDummy3[ 4 ];



};
typedef struct xSTATIC_LIST_ITEM StaticListItem_t;


struct xSTATIC_MINI_LIST_ITEM
{



 TickType_t xDummy2;
 void *pvDummy3[ 2 ];
};
typedef struct xSTATIC_MINI_LIST_ITEM StaticMiniListItem_t;


typedef struct xSTATIC_LIST
{



 UBaseType_t uxDummy2;
 void *pvDummy3;
 StaticMiniListItem_t xDummy4;



} StaticList_t;
# 1112 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
typedef struct xSTATIC_TCB
{
 void *pxDummy1;



 StaticListItem_t xDummy3[ 2 ];
 UBaseType_t uxDummy5;
 void *pxDummy6;
 uint8_t ucDummy7[ ( 16 ) ];




  UBaseType_t uxDummy9;


  UBaseType_t uxDummy10[ 2 ];


  UBaseType_t uxDummy12[ 2 ];





  void *pvDummy15[ 1 ];
# 1147 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
  uint32_t ulDummy18;
  uint8_t ucDummy19;


  uint8_t uxDummy20;
# 1160 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
} StaticTask_t;
# 1176 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
typedef struct xSTATIC_QUEUE
{
 void *pvDummy1[ 3 ];

 union
 {
  void *pvDummy2;
  UBaseType_t uxDummy2;
 } u;

 StaticList_t xDummy3[ 2 ];
 UBaseType_t uxDummy4[ 3 ];
 uint8_t ucDummy5[ 2 ];


  uint8_t ucDummy6;







  UBaseType_t uxDummy8;
  uint8_t ucDummy9;


} StaticQueue_t;
typedef StaticQueue_t StaticSemaphore_t;
# 1220 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
typedef struct xSTATIC_EVENT_GROUP
{
 TickType_t xDummy1;
 StaticList_t xDummy2;


  UBaseType_t uxDummy3;



   uint8_t ucDummy4;


} StaticEventGroup_t;
# 1249 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
typedef struct xSTATIC_TIMER
{
 void *pvDummy1;
 StaticListItem_t xDummy2;
 TickType_t xDummy3;
 void *pvDummy5;
 TaskFunction_t pvDummy6;

  UBaseType_t uxDummy7;

 uint8_t ucDummy8;

} StaticTimer_t;
# 1277 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/FreeRTOS.h"
typedef struct xSTATIC_STREAM_BUFFER
{
 size_t uxDummy1[ 4 ];
 void * pvDummy2[ 3 ];
 uint8_t ucDummy3;

  UBaseType_t uxDummy4;

} StaticStreamBuffer_t;


typedef StaticStreamBuffer_t StaticMessageBuffer_t;

void vInitializeBL602(void);
# 40 "/home/chandu/sdk/bl602_iot_sdk/components/utils/include/utils_log.h" 2
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h" 1
# 36 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
# 1 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/list.h" 1
# 139 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/list.h"
struct xLIST;
struct xLIST_ITEM
{

 TickType_t xItemValue;
 struct xLIST_ITEM * pxNext;
 struct xLIST_ITEM * pxPrevious;
 void * pvOwner;
 struct xLIST * pvContainer;

};
typedef struct xLIST_ITEM ListItem_t;

struct xMINI_LIST_ITEM
{

 TickType_t xItemValue;
 struct xLIST_ITEM * pxNext;
 struct xLIST_ITEM * pxPrevious;
};
typedef struct xMINI_LIST_ITEM MiniListItem_t;




typedef struct xLIST
{

 volatile UBaseType_t uxNumberOfItems;
 ListItem_t * pxIndex;
 MiniListItem_t xListEnd;

} List_t;
# 345 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/list.h"
void vListInitialise( List_t * const pxList ) ;
# 356 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/list.h"
void vListInitialiseItem( ListItem_t * const pxItem ) ;
# 369 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/list.h"
void vListInsert( List_t * const pxList, ListItem_t * const pxNewListItem ) ;
# 390 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/list.h"
void vListInsertEnd( List_t * const pxList, ListItem_t * const pxNewListItem ) ;
# 405 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/list.h"
UBaseType_t uxListRemove( ListItem_t * const pxItemToRemove ) ;
# 37 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h" 2
# 69 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
struct tskTaskControlBlock;
typedef struct tskTaskControlBlock* TaskHandle_t;





typedef BaseType_t (*TaskHookFunction_t)( void * );


typedef enum
{
 eRunning = 0,
 eReady,
 eBlocked,
 eSuspended,
 eDeleted,
 eInvalid
} eTaskState;


typedef enum
{
 eNoAction = 0,
 eSetBits,
 eIncrement,
 eSetValueWithOverwrite,
 eSetValueWithoutOverwrite
} eNotifyAction;




typedef struct xTIME_OUT
{
 BaseType_t xOverflowCount;
 TickType_t xTimeOnEntering;
} TimeOut_t;




typedef struct xMEMORY_REGION
{
 void *pvBaseAddress;
 uint32_t ulLengthInBytes;
 uint32_t ulParameters;
} MemoryRegion_t;




typedef struct xTASK_PARAMETERS
{
 TaskFunction_t pvTaskCode;
 const char * const pcName;
 uint16_t usStackDepth;
 void *pvParameters;
 UBaseType_t uxPriority;
 StackType_t *puxStackBuffer;
 MemoryRegion_t xRegions[ 1 ];



} TaskParameters_t;



typedef struct xTASK_STATUS
{
 TaskHandle_t xHandle;
 const char *pcTaskName;
 UBaseType_t xTaskNumber;
 eTaskState eCurrentState;
 UBaseType_t uxCurrentPriority;
 UBaseType_t uxBasePriority;
 uint32_t ulRunTimeCounter;
 StackType_t *pxStackBase;
 uint16_t usStackHighWaterMark;
} TaskStatus_t;


typedef enum
{
 eAbortSleep = 0,
 eStandardSleep,
 eNoTasksWaitingTimeout
} eSleepModeStatus;
# 330 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
 BaseType_t xTaskCreate( TaskFunction_t pxTaskCode,
       const char * const pcName,
       const uint16_t usStackDepth,
       void * const pvParameters,
       UBaseType_t uxPriority,
       TaskHandle_t * const pxCreatedTask ) ;
# 446 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
 TaskHandle_t xTaskCreateStatic( TaskFunction_t pxTaskCode,
         const char * const pcName,
         const uint32_t ulStackDepth,
         void * const pvParameters,
         UBaseType_t uxPriority,
         StackType_t * const puxStackBuffer,
         StaticTask_t * const pxTaskBuffer ) ;
# 665 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskAllocateMPURegions( TaskHandle_t xTask, const MemoryRegion_t * const pxRegions ) ;
# 706 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskDelete( TaskHandle_t xTaskToDelete ) ;
# 758 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskDelay( const TickType_t xTicksToDelay ) ;
# 817 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskDelayUntil( TickType_t * const pxPreviousWakeTime, const TickType_t xTimeIncrement ) ;
# 847 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskAbortDelay( TaskHandle_t xTask ) ;
# 894 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
UBaseType_t uxTaskPriorityGet( const TaskHandle_t xTask ) ;







UBaseType_t uxTaskPriorityGetFromISR( const TaskHandle_t xTask ) ;
# 920 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
eTaskState eTaskGetState( TaskHandle_t xTask ) ;
# 976 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskGetInfo( TaskHandle_t xTask, TaskStatus_t *pxTaskStatus, BaseType_t xGetFreeStackSpace, eTaskState eState ) ;
# 1018 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskPrioritySet( TaskHandle_t xTask, UBaseType_t uxNewPriority ) ;
# 1069 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskSuspend( TaskHandle_t xTaskToSuspend ) ;
# 1118 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskResume( TaskHandle_t xTaskToResume ) ;
# 1147 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskResumeFromISR( TaskHandle_t xTaskToResume ) ;
# 1180 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskStartScheduler( void ) ;
# 1236 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskEndScheduler( void ) ;
# 1287 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskSuspendAll( void ) ;
# 1341 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskResumeAll( void ) ;
# 1356 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
TickType_t xTaskGetTickCount( void ) ;
BaseType_t xTaskGetTickCount2( TickType_t *ticks, BaseType_t *overflow ) ;
# 1373 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
TickType_t xTaskGetTickCountFromISR( void ) ;
# 1387 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
UBaseType_t uxTaskGetNumberOfTasks( void ) ;
# 1400 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
char *pcTaskGetName( TaskHandle_t xTaskToQuery ) ;
# 1416 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
TaskHandle_t xTaskGetHandle( const char *pcNameToQuery ) ;
# 1443 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
UBaseType_t uxTaskGetStackHighWaterMark( TaskHandle_t xTask ) ;
# 1470 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
uint16_t uxTaskGetStackHighWaterMark2( TaskHandle_t xTask ) ;
# 1518 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
 void vTaskSetThreadLocalStoragePointer( TaskHandle_t xTaskToSet, BaseType_t xIndex, void *pvValue ) ;
 void *pvTaskGetThreadLocalStoragePointer( TaskHandle_t xTaskToQuery, BaseType_t xIndex ) ;
# 1534 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskCallApplicationTaskHook( TaskHandle_t xTask, void *pvParameter ) ;
# 1543 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
TaskHandle_t xTaskGetIdleTaskHandle( void ) ;
# 1642 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
UBaseType_t uxTaskGetSystemState( TaskStatus_t * const pxTaskStatusArray, const UBaseType_t uxArraySize, uint32_t * const pulTotalRunTime ) ;
# 1689 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskList( char * pcWriteBuffer ) ;
# 1743 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskGetRunTimeStats( char *pcWriteBuffer ) ;
# 1773 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
uint32_t ulTaskGetIdleRunTimeCounter( void ) ;
# 1854 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskGenericNotify( TaskHandle_t xTaskToNotify, uint32_t ulValue, eNotifyAction eAction, uint32_t *pulPreviousNotificationValue ) ;
# 1945 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskGenericNotifyFromISR( TaskHandle_t xTaskToNotify, uint32_t ulValue, eNotifyAction eAction, uint32_t *pulPreviousNotificationValue, BaseType_t *pxHigherPriorityTaskWoken ) ;
# 2022 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskNotifyWait( uint32_t ulBitsToClearOnEntry, uint32_t ulBitsToClearOnExit, uint32_t *pulNotificationValue, TickType_t xTicksToWait ) ;
# 2123 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskNotifyGiveFromISR( TaskHandle_t xTaskToNotify, BaseType_t *pxHigherPriorityTaskWoken ) ;
# 2192 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
uint32_t ulTaskNotifyTake( BaseType_t xClearCountOnExit, TickType_t xTicksToWait ) ;
# 2208 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskNotifyStateClear( TaskHandle_t xTask );
# 2226 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
uint32_t ulTaskNotifyValueClear( TaskHandle_t xTask, uint32_t ulBitsToClear ) ;
# 2240 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskSetTimeOutState( TimeOut_t * const pxTimeOut ) ;
# 2323 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskCheckForTimeOut( TimeOut_t * const pxTimeOut, TickType_t * const pxTicksToWait ) ;
# 2344 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskIncrementTick( void ) ;
# 2377 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskPlaceOnEventList( List_t * const pxEventList, const TickType_t xTicksToWait ) ;
void vTaskPlaceOnUnorderedEventList( List_t * pxEventList, const TickType_t xItemValue, const TickType_t xTicksToWait ) ;
# 2391 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskPlaceOnEventListRestricted( List_t * const pxEventList, TickType_t xTicksToWait, const BaseType_t xWaitIndefinitely ) ;
# 2417 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskRemoveFromEventList( const List_t * const pxEventList ) ;
void vTaskRemoveFromUnorderedEventList( ListItem_t * pxEventListItem, const TickType_t xItemValue ) ;
# 2428 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
 void vTaskSwitchContext( void ) ;





TickType_t uxTaskResetEventItemValue( void ) ;




TaskHandle_t xTaskGetCurrentTaskHandle( void ) ;





void vTaskMissedYield( void ) ;





BaseType_t xTaskGetSchedulerState( void ) ;





BaseType_t xTaskPriorityInherit( TaskHandle_t const pxMutexHolder ) ;





BaseType_t xTaskPriorityDisinherit( TaskHandle_t const pxMutexHolder ) ;
# 2473 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskPriorityDisinheritAfterTimeout( TaskHandle_t const pxMutexHolder, UBaseType_t uxHighestPriorityWaitingTask ) ;




UBaseType_t uxTaskGetTaskNumber( TaskHandle_t xTask ) ;





void vTaskSetTaskNumber( TaskHandle_t xTask, const UBaseType_t uxHandle ) ;
# 2494 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
void vTaskStepTick( const TickType_t xTicksToJump ) ;
void vTaskStepTickSafe( const TickType_t xTicksToJump ) ;
# 2508 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
BaseType_t xTaskCatchUpTicks( TickType_t xTicksToCatchUp ) ;
# 2524 "/home/chandu/sdk/bl602_iot_sdk/components/freertos/include/task.h"
eSleepModeStatus eTaskConfirmSleepModeStatus( void ) ;





TaskHandle_t pvTaskIncrementMutexHeldCount( void ) ;





void vTaskInternalSetTimeOutState( TimeOut_t * const pxTimeOut ) ;
# 41 "/home/chandu/sdk/bl602_iot_sdk/components/utils/include/utils_log.h" 2
# 85 "/home/chandu/sdk/bl602_iot_sdk/components/utils/include/utils_log.h"
typedef enum LOG_BUF_OUT_DATA_TYPE {
    LOG_BUF_OUT_DATA_TYPE_HEX,
    LOG_BUF_OUT_DATA_TYPE_INT8,
    LOG_BUF_OUT_DATA_TYPE_UNT8,
} LOG_BUF_OUT_DATA_TYPE_T;
# 156 "/home/chandu/sdk/bl602_iot_sdk/components/utils/include/utils_log.h"
int log_buf_out(const char *file, int line, const void *inbuf, int len, LOG_BUF_OUT_DATA_TYPE_T type);

void bl_printk(const char *format, ...);
# 32 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 2
# 135 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
enum sector_store_status {
    SECTOR_STORE_UNUSED,
    SECTOR_STORE_EMPTY,
    SECTOR_STORE_USING,
    SECTOR_STORE_FULL,
    SECTOR_STORE_STATUS_NUM,
};
typedef enum sector_store_status sector_store_status_t;

enum sector_dirty_status {
    SECTOR_DIRTY_UNUSED,
    SECTOR_DIRTY_FALSE,
    SECTOR_DIRTY_TRUE,
    SECTOR_DIRTY_GC,
    SECTOR_DIRTY_STATUS_NUM,
};
typedef enum sector_dirty_status sector_dirty_status_t;

struct sector_hdr_data {
    struct {
        uint8_t store[(((SECTOR_STORE_STATUS_NUM - 1) * (1 * 8) + 7)/8)];
        uint8_t dirty[(((SECTOR_DIRTY_STATUS_NUM - 1) * (1 * 8) + 7)/8)];
    } status_table;
    uint32_t magic;
    uint32_t combined;
    uint32_t reserved;
};
typedef struct sector_hdr_data *sector_hdr_data_t;

struct sector_meta_data {
    bool check_ok;
    struct {
        sector_store_status_t store;
        sector_dirty_status_t dirty;
    } status;
    uint32_t addr;
    uint32_t magic;
    uint32_t combined;
    size_t remain;
    uint32_t empty_env;
};
typedef struct sector_meta_data *sector_meta_data_t;

struct env_hdr_data {
    uint8_t status_table[(((ENV_STATUS_NUM - 1) * (1 * 8) + 7)/8)];
    uint32_t magic;
    uint32_t len;
    uint32_t crc32;
    uint8_t name_len;
    uint32_t value_len;
};
typedef struct env_hdr_data *env_hdr_data_t;

struct env_cache_node {
    uint16_t name_crc;
    uint16_t active;
    uint32_t addr;
};
typedef struct env_cache_node *env_cache_node_t;

struct sector_cache_node {
    uint32_t addr;
    uint32_t empty_addr;
};
typedef struct sector_cache_node *sector_cache_node_t;

static void gc_collect(void);


static uint32_t env_start_addr = 0;

static ef_env const *default_env_set;

static size_t default_env_set_size = 0;

static bool init_ok = false;

static bool gc_request = false;

static bool in_recovery_check = false;



struct env_cache_node env_cache_table[16] = { 0 };

struct sector_cache_node sector_cache_table[4] = { 0 };


static size_t set_status(uint8_t status_table[], size_t status_num, size_t status_index)
{
    size_t byte_index = ~0UL;







    memset(status_table, 0xFF, (((status_num - 1) * (1 * 8) + 7)/8));
    if (status_index > 0) {




        byte_index = (status_index - 1) * ((1 * 8) / 8);
        status_table[byte_index] = 0x00;

    }

    return byte_index;
}

static size_t get_status(uint8_t status_table[], size_t status_num)
{
    size_t i = 0, status_num_bak = --status_num;

    while (status_num --) {






        if (status_table[status_num * (1 * 8) / 8] == 0x00) {
            break;
        }

        i++;
    }

    return status_num_bak - i;
}

static EfErrCode write_status(uint32_t addr, uint8_t status_table[], size_t status_num, size_t status_index)
{
    EfErrCode result = EF_NO_ERR;
    size_t byte_index;

    if (!(status_index < status_num)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 273, "(%s) has assert failed at %s.\r\n", "status_index < status_num", __FUNCTION__); while (1); };
    if (!(status_table)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 274, "(%s) has assert failed at %s.\r\n", "status_table", __FUNCTION__); while (1); };


    byte_index = set_status(status_table, status_num, status_index);


    if (byte_index == ~0UL) {
        return EF_NO_ERR;
    }





    result = ef_port_write(addr + byte_index, (uint32_t *) &status_table[byte_index], (1 * 8) / 8);


    return result;
}

static size_t read_status(uint32_t addr, uint8_t status_table[], size_t total_num)
{
    if (!(status_table)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 296, "(%s) has assert failed at %s.\r\n", "status_table", __FUNCTION__); while (1); };

    ef_port_read(addr, (uint32_t *) status_table, (((total_num - 1) * (1 * 8) + 7)/8));

    return get_status(status_table, total_num);
}





static void update_sector_cache(uint32_t sec_addr, uint32_t empty_addr)
{
    size_t i, empty_index = 4;

    for (i = 0; i < 4; i++) {
        if ((empty_addr > sec_addr) && (empty_addr < sec_addr + (4096))) {

            if (sector_cache_table[i].addr == sec_addr) {
                sector_cache_table[i].addr = sec_addr;
                sector_cache_table[i].empty_addr = empty_addr;
                return;
            } else if ((sector_cache_table[i].addr == 0xFFFFFFFF) && (empty_index == 4)) {
                empty_index = i;
            }
        } else if (sector_cache_table[i].addr == sec_addr) {

            sector_cache_table[i].addr = 0xFFFFFFFF;
            return;
        }
    }

    if (empty_index < 4) {
        sector_cache_table[empty_index].addr = sec_addr;
        sector_cache_table[empty_index].empty_addr = empty_addr;
    }
}




static bool get_sector_from_cache(uint32_t sec_addr, uint32_t *empty_addr)
{
    size_t i;

    for (i = 0; i < 4; i++) {
        if (sector_cache_table[i].addr == sec_addr) {
            if (empty_addr) {
                *empty_addr = sector_cache_table[i].empty_addr;
            }
            return true;
        }
    }

    return false;
}

static void update_env_cache(const char *name, size_t name_len, uint32_t addr)
{
    size_t i, empty_index = 16, min_activity_index = 16;
    uint16_t name_crc = (uint16_t) (ef_calc_crc32(0, name, name_len) >> 16), min_activity = 0xFFFF;

    for (i = 0; i < 16; i++) {
        if (addr != 0xFFFFFFFF) {

            if (env_cache_table[i].name_crc == name_crc) {
                env_cache_table[i].addr = addr;
                return;
            } else if ((env_cache_table[i].addr == 0xFFFFFFFF) && (empty_index == 16)) {
                empty_index = i;
            } else if (env_cache_table[i].addr != 0xFFFFFFFF) {
                if (env_cache_table[i].active > 0) {
                    env_cache_table[i].active--;
                }
                if (env_cache_table[i].active < min_activity) {
                    min_activity_index = i;
                    min_activity = env_cache_table[i].active;
                }
            }
        } else if (env_cache_table[i].name_crc == name_crc) {

            env_cache_table[i].addr = 0xFFFFFFFF;
            env_cache_table[i].active = 0;
            return;
        }
    }

    if (empty_index < 16) {
        env_cache_table[empty_index].addr = addr;
        env_cache_table[empty_index].name_crc = name_crc;
        env_cache_table[empty_index].active = 0;
    } else if (min_activity_index < 16) {
        env_cache_table[min_activity_index].addr = addr;
        env_cache_table[min_activity_index].name_crc = name_crc;
        env_cache_table[min_activity_index].active = 0;
    }
}




static bool get_env_from_cache(const char *name, size_t name_len, uint32_t *addr)
{
    size_t i;
    uint16_t name_crc = (uint16_t) (ef_calc_crc32(0, name, name_len) >> 16);

    for (i = 0; i < 16; i++) {
        if ((env_cache_table[i].addr != 0xFFFFFFFF) && (env_cache_table[i].name_crc == name_crc)) {
            char saved_name[(64)];

            ef_port_read(env_cache_table[i].addr + (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))), (uint32_t *) saved_name, (64));
            if (!strncmp(name, saved_name, name_len)) {
                *addr = env_cache_table[i].addr;
                if (env_cache_table[i].active >= 0xFFFF - 16) {
                    env_cache_table[i].active = 0xFFFF;
                } else {
                    env_cache_table[i].active += 16;
                }
                return true;
            }
        }
    }

    return false;
}





static uint32_t continue_ff_addr(uint32_t start, uint32_t end)
{
    uint8_t buf[32], last_data = 0x00;
    size_t i, addr = start, read_size;

    for (; start < end; start += sizeof(buf)) {
        if (start + sizeof(buf) < end) {
            read_size = sizeof(buf);
        } else {
            read_size = end - start;
        }
        ef_port_read(start, (uint32_t *) buf, read_size);
        for (i = 0; i < read_size; i++) {
            if (last_data != 0xFF && buf[i] == 0xFF) {
                addr = start + i;
            }
            last_data = buf[i];
        }
    }

    if (last_data == 0xFF) {
        return ((((addr) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)));
    } else {
        return end;
    }
}




static uint32_t find_next_env_addr(uint32_t start, uint32_t end)
{
    uint8_t buf[32];
    uint32_t start_bak = start, i;
    uint32_t magic;


    uint32_t empty_env;

    if (get_sector_from_cache(((start) & ~(((4096)) - 1)), &empty_env) && start == empty_env) {
        return 0xFFFFFFFF;
    }


    for (; start < end; start += (sizeof(buf) - sizeof(uint32_t))) {
        ef_port_read(start, (uint32_t *) buf, sizeof(buf));
        for (i = 0; i < sizeof(buf) - sizeof(uint32_t) && start + i < end; i++) {

            magic = buf[i] + (buf[i + 1] << 8) + (buf[i + 2] << 16) + (buf[i + 3] << 24);



            if (magic == 0x3034564B && (start + i - ((unsigned long)(&((struct env_hdr_data *)0)->magic))) >= start_bak) {
                return start + i - ((unsigned long)(&((struct env_hdr_data *)0)->magic));
            }
        }
    }

    return 0xFFFFFFFF;
}

static uint32_t get_next_env_addr(sector_meta_data_t sector, env_node_obj_t pre_env)
{
    uint32_t addr = 0xFFFFFFFF;

    if (sector->status.store == SECTOR_STORE_EMPTY) {
        return 0xFFFFFFFF;
    }

    if (pre_env->addr.start == 0xFFFFFFFF) {

        addr = sector->addr + (((((sizeof(struct sector_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
    } else {
        if (pre_env->addr.start <= sector->addr + (4096)) {
            if (pre_env->crc_is_ok) {
                addr = pre_env->addr.start + pre_env->len;
            } else {


                addr = pre_env->addr.start + ((((1) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)));
            }

            addr = find_next_env_addr(addr, sector->addr + (4096) - (((((sizeof(struct sector_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))));

            if (addr > sector->addr + (4096) || pre_env->len == 0) {

                return 0xFFFFFFFF;
            }
        } else {

            return 0xFFFFFFFF;
        }
    }

    return addr;
}

static EfErrCode read_env(env_node_obj_t env)
{
    struct env_hdr_data env_hdr;
    uint8_t buf[32];
    uint32_t calc_crc32 = 0, crc_data_len, env_name_addr;
    EfErrCode result = EF_NO_ERR;
    size_t len, size;

    ef_port_read(env->addr.start, (uint32_t *)&env_hdr, sizeof(struct env_hdr_data));
    env->status = (env_status_t) get_status(env_hdr.status_table, ENV_STATUS_NUM);
    env->len = env_hdr.len;

    if (env->len == ~0UL || env->len > (2 * (16384)) || env->len < ((unsigned long)(&((struct env_hdr_data *)0)->name_len))) {

        env->len = (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
        if (env->status != ENV_ERR_HDR) {
            env->status = ENV_ERR_HDR;
            ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 540, "Error: The ENV @0x%08X length has an error.\r\n", env->addr.start);
            write_status(env->addr.start, env_hdr.status_table, ENV_STATUS_NUM, ENV_ERR_HDR);
        }
        env->crc_is_ok = false;
        return EF_READ_ERR;
    } else if (env->len > (4096) - (((((sizeof(struct sector_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))) && env->len < (2 * (16384))) {

        if (!(0)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 547, "(%s) has assert failed at %s.\r\n", "0", __FUNCTION__); while (1); };
    }


    crc_data_len = env->len - ((unsigned long)(&((struct env_hdr_data *)0)->name_len));

    for (len = 0, size = 0; len < crc_data_len; len += size) {
        if (len + sizeof(buf) < crc_data_len) {
            size = sizeof(buf);
        } else {
            size = crc_data_len - len;
        }

        ef_port_read(env->addr.start + ((unsigned long)(&((struct env_hdr_data *)0)->name_len)) + len, (uint32_t *) buf, ((((size) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
        calc_crc32 = ef_calc_crc32(calc_crc32, buf, size);
    }

    if (calc_crc32 != env_hdr.crc32) {
        env->crc_is_ok = false;
        result = EF_READ_ERR;
    } else {
        env->crc_is_ok = true;

        env_name_addr = env->addr.start + (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
        ef_port_read(env_name_addr, (uint32_t *) env->name, ((((env_hdr.name_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));

        env->addr.value = env_name_addr + ((((env_hdr.name_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)));
        env->value_len = env_hdr.value_len;
        env->name_len = env_hdr.name_len;
    }

    return result;
}

static EfErrCode read_sector_meta_data(uint32_t addr, sector_meta_data_t sector, bool traversal)
{
    EfErrCode result = EF_NO_ERR;
    struct sector_hdr_data sec_hdr;

    if (!(addr % (4096) == 0)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 586, "(%s) has assert failed at %s.\r\n", "addr % SECTOR_SIZE == 0", __FUNCTION__); while (1); };
    if (!(sector)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 587, "(%s) has assert failed at %s.\r\n", "sector", __FUNCTION__); while (1); };


    ef_port_read(addr, (uint32_t *)&sec_hdr, sizeof(struct sector_hdr_data));

    sector->addr = addr;
    sector->magic = sec_hdr.magic;

    if (sector->magic != 0x30344645) {
        sector->check_ok = false;
        sector->combined = 0xFFFFFFFF;
        return EF_ENV_INIT_FAILED;
    }
    sector->check_ok = true;

    sector->combined = sec_hdr.combined;
    sector->status.store = (sector_store_status_t) get_status(sec_hdr.status_table.store, SECTOR_STORE_STATUS_NUM);
    sector->status.dirty = (sector_dirty_status_t) get_status(sec_hdr.status_table.dirty, SECTOR_DIRTY_STATUS_NUM);

    if (traversal) {
        sector->remain = 0;
        sector->empty_env = sector->addr + (((((sizeof(struct sector_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
        if (sector->status.store == SECTOR_STORE_EMPTY) {
            sector->remain = (4096) - (((((sizeof(struct sector_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
        } else if (sector->status.store == SECTOR_STORE_USING) {
            struct env_node_obj env_meta;


            if (get_sector_from_cache(addr, &sector->empty_env)) {
                sector->remain = (4096) - (sector->empty_env - sector->addr);
                return result;
            }


            sector->remain = (4096) - (((((sizeof(struct sector_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
            env_meta.addr.start = 0xFFFFFFFF;
            while ((env_meta.addr.start = get_next_env_addr(sector, &env_meta)) != 0xFFFFFFFF) {
                read_env(&env_meta);
                if (!env_meta.crc_is_ok) {
                    if (env_meta.status != ENV_PRE_WRITE && env_meta.status!= ENV_ERR_HDR) {
                        ef_log_info("Error: The ENV (@0x%08X) CRC32 check failed!\r\n", env_meta.addr.start);
                        sector->remain = 0;
                        result = EF_READ_ERR;
                        break;
                    }
                }
                sector->empty_env += env_meta.len;
                sector->remain -= env_meta.len;
            }

            {
                uint32_t ff_addr;

                ff_addr = continue_ff_addr(sector->empty_env, sector->addr + (4096));

                if (sector->empty_env != ff_addr) {

                    sector->empty_env = ff_addr;
                    sector->remain = (4096) - (ff_addr - sector->addr);
                }
            }


            update_sector_cache(sector->addr, sector->empty_env);

        }
    }

    return result;
}

static uint32_t get_next_sector_addr(sector_meta_data_t pre_sec)
{
    uint32_t next_addr;

    if (pre_sec->addr == 0xFFFFFFFF) {
        return env_start_addr;
    } else {

        if (pre_sec->combined == 0xFFFFFFFF) {
            next_addr = pre_sec->addr + (4096);
        } else {
            next_addr = pre_sec->addr + pre_sec->combined * (4096);
        }

        if (next_addr < env_start_addr + (2 * (16384))) {
            return next_addr;
        } else {

            return 0xFFFFFFFF;
        }
    }
}

static void env_iterator(env_node_obj_t env, void *arg1, void *arg2,
        bool (*callback)(env_node_obj_t env, void *arg1, void *arg2))
{
    struct sector_meta_data sector;
    uint32_t sec_addr;

    sector.addr = 0xFFFFFFFF;

    while ((sec_addr = get_next_sector_addr(&sector)) != 0xFFFFFFFF) {
        if (read_sector_meta_data(sec_addr, &sector, false) != EF_NO_ERR) {
            continue;
        }
        if (callback == 
# 693 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                       ((void *)0)
# 693 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                           ) {
            continue;
        }

        if (sector.status.store == SECTOR_STORE_USING || sector.status.store == SECTOR_STORE_FULL) {
            env->addr.start = 0xFFFFFFFF;

            while ((env->addr.start = get_next_env_addr(&sector, env)) != 0xFFFFFFFF) {
                read_env(env);

                if (callback(env, arg1, arg2)) {
                    return;
                }
            }
        }
    }
}

static bool find_env_cb(env_node_obj_t env, void *arg1, void *arg2)
{
    const char *key = arg1;
    bool *find_ok = arg2;
    size_t key_len = strlen(key);

    if (key_len != env->name_len) {
        return false;
    }

    if (env->crc_is_ok && env->status == ENV_WRITE && !strncmp(env->name, key, key_len)) {
        *find_ok = true;
        return true;
    }
    return false;
}

static bool find_env_no_cache(const char *key, env_node_obj_t env)
{
    bool find_ok = false;

    env_iterator(env, (void *)key, &find_ok, find_env_cb);

    return find_ok;
}

static bool find_env(const char *key, env_node_obj_t env)
{
    bool find_ok = false;


    size_t key_len = strlen(key);

    if (get_env_from_cache(key, key_len, &env->addr.start)) {
        read_env(env);
        return true;
    }


    find_ok = find_env_no_cache(key, env);


    if (find_ok) {
        update_env_cache(key, key_len, env->addr.start);
    }


    return find_ok;
}

static bool ef_is_str(uint8_t *value, size_t len)
{

    size_t i;

    for (i = 0; i < len; i++) {
        if (!((unsigned int)((value[i]) - ' ') < 127u - ' ')) {
            return false;
        }
    }
    return true;
}

static size_t get_env(const char *key, void *value_buf, size_t buf_len, size_t *value_len)
{
    struct env_node_obj env;
    size_t read_len = 0;

    if (find_env(key, &env)) {
        if (value_len) {
            *value_len = env.value_len;
        }
        if (buf_len > env.value_len) {
            read_len = env.value_len;
        } else {
            read_len = buf_len;
        }
        if (value_buf){
            ef_port_read(env.addr.value, (uint32_t *) value_buf, read_len);
        }
    }

    return read_len;
}
# 804 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
bool ef_get_env_obj(const char *key, env_node_obj_t env)
{
    bool find_ok = false;

    if (!init_ok) {
        ef_log_info("ENV isn't initialize OK.\r\n");
        return 0;
    }


    ef_port_env_lock();

    find_ok = find_env(key, env);


    ef_port_env_unlock();

    return find_ok;
}
# 834 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
size_t ef_get_env_blob(const char *key, void *value_buf, size_t buf_len, size_t *saved_value_len)
{
    size_t read_len = 0;

    if (!init_ok) {
        ef_log_info("ENV isn't initialize OK.\r\n");
        return 0;
    }

    if (!key || !value_buf) {
        do { ; bl_printk("[%10u][%s: %s:%4d] " "key = %p, value_buf = %p\r\n", (xPortIsInsideInterrupt())?(xTaskGetTickCountFromISR()):(xTaskGetTickCount()), "\x1b[33mWARN  \x1b[0m", "ef_env.c", 844, key, value_buf); ; } while(0==1);
        return EF_ENV_ARG_ERR;
    }

    if (strlen(key) > (64)) {
        do { ; bl_printk("[%10u][%s: %s:%4d] " "key err. %d > %d\r\n", (xPortIsInsideInterrupt())?(xTaskGetTickCountFromISR()):(xTaskGetTickCount()), "\x1b[33mWARN  \x1b[0m", "ef_env.c", 849, strlen(key), (64)); ; } while(0==1);
        return EF_ENV_ARG_ERR;
    }

    ef_port_env_lock();

    read_len = get_env(key, value_buf, buf_len, saved_value_len);


    ef_port_env_unlock();

    return read_len;
}
# 873 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
char *ef_get_env(const char *key)
{
    static char value[(3980) + 1];
    size_t get_size;

    if ((get_size = ef_get_env_blob(key, value, (3980), 
# 878 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                                                          ((void *)0)
# 878 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                                                              )) > 0) {

        if (ef_is_str((uint8_t *)value, get_size)) {
            value[get_size] = '\0';
            return value;
        } else {
            ef_log_info("Warning: The ENV value isn't string. Could not be returned\r\n");
            return 
# 885 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                  ((void *)0)
# 885 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                      ;
        }
    }

    return 
# 889 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
          ((void *)0)
# 889 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
              ;
}
# 901 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
size_t ef_read_env_value(env_node_obj_t env, uint8_t *value_buf, size_t buf_len)
{
    size_t read_len = 0;

    if (!(env)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 905, "(%s) has assert failed at %s.\r\n", "env", __FUNCTION__); while (1); };
    if (!(value_buf)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 906, "(%s) has assert failed at %s.\r\n", "value_buf", __FUNCTION__); while (1); };

    if (!init_ok) {
        ef_log_info("ENV isn't initialize OK.\r\n");
        return 0;
    }

    if (env->crc_is_ok) {

        ef_port_env_lock();

        if (buf_len > env->value_len) {
            read_len = env->value_len;
        } else {
            read_len = buf_len;
        }

        ef_port_read(env->addr.value, (uint32_t *) value_buf, read_len);

        ef_port_env_unlock();
    }

    return read_len;
}

static EfErrCode write_env_hdr(uint32_t addr, env_hdr_data_t env_hdr) {
    EfErrCode result = EF_NO_ERR;

    result = write_status(addr, env_hdr->status_table, ENV_STATUS_NUM, ENV_PRE_WRITE);
    if (result != EF_NO_ERR) {
        return result;
    }

    result = ef_port_write(addr + ((unsigned long)(&((struct env_hdr_data *)0)->magic)), &env_hdr->magic, sizeof(struct env_hdr_data) - ((unsigned long)(&((struct env_hdr_data *)0)->magic)));

    return result;
}

static EfErrCode format_sector(uint32_t addr, uint32_t combined_value)
{
    EfErrCode result = EF_NO_ERR;
    struct sector_hdr_data sec_hdr;

    if (!(addr % (4096) == 0)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 949, "(%s) has assert failed at %s.\r\n", "addr % SECTOR_SIZE == 0", __FUNCTION__); while (1); };

    result = ef_port_erase(addr, (4096));
    if (result == EF_NO_ERR) {

        memset(&sec_hdr, 0xFF, sizeof(struct sector_hdr_data));
        set_status(sec_hdr.status_table.store, SECTOR_STORE_STATUS_NUM, SECTOR_STORE_EMPTY);
        set_status(sec_hdr.status_table.dirty, SECTOR_DIRTY_STATUS_NUM, SECTOR_DIRTY_FALSE);
        sec_hdr.magic = 0x30344645;
        sec_hdr.combined = combined_value;
        sec_hdr.reserved = 0xFFFFFFFF;

        result = ef_port_write(addr, (uint32_t *)&sec_hdr, sizeof(struct sector_hdr_data));



        update_sector_cache(addr, addr + (4096));

    }

    return result;
}

static EfErrCode update_sec_status(sector_meta_data_t sector, size_t new_env_len, bool *is_full)
{
    uint8_t status_table[(((SECTOR_STORE_STATUS_NUM - 1) * (1 * 8) + 7)/8)];
    EfErrCode result = EF_NO_ERR;

    if (sector->status.store == SECTOR_STORE_EMPTY) {

        result = write_status(sector->addr, status_table, SECTOR_STORE_STATUS_NUM, SECTOR_STORE_USING);
    } else if (sector->status.store == SECTOR_STORE_USING) {

        if (sector->remain < ((((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))) + (64)) || sector->remain - new_env_len < ((((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))) + (64))) {

            result = write_status(sector->addr, status_table, SECTOR_STORE_STATUS_NUM, SECTOR_STORE_FULL);



            update_sector_cache(sector->addr, sector->addr + (4096));


            if (is_full) {
                *is_full = true;
            }
        } else if (is_full) {
            *is_full = false;
        }
    }

    return result;
}

static void sector_iterator(sector_meta_data_t sector, sector_store_status_t status, void *arg1, void *arg2,
        bool (*callback)(sector_meta_data_t sector, void *arg1, void *arg2), bool traversal_env) {
    uint32_t sec_addr;


    sector->addr = 0xFFFFFFFF;
    while ((sec_addr = get_next_sector_addr(sector)) != 0xFFFFFFFF) {
        read_sector_meta_data(sec_addr, sector, false);
        if (status == SECTOR_STORE_UNUSED || status == sector->status.store) {
            if (traversal_env) {
                read_sector_meta_data(sec_addr, sector, traversal_env);
            }

            if (callback && callback(sector, arg1, arg2)) {
                return;
            }
        }
    }
}

static bool sector_statistics_cb(sector_meta_data_t sector, void *arg1, void *arg2)
{
    size_t *empty_sector = arg1, *using_sector = arg2;

    if (sector->check_ok && sector->status.store == SECTOR_STORE_EMPTY) {
        (*empty_sector)++;
    } else if (sector->check_ok && sector->status.store == SECTOR_STORE_USING) {
        (*using_sector)++;
    }

    return false;
}

static bool alloc_env_cb(sector_meta_data_t sector, void *arg1, void *arg2)
{
    size_t *env_size = arg1;
    uint32_t *empty_env = arg2;




    if (sector->check_ok && sector->remain > *env_size
            && ((sector->status.dirty == SECTOR_DIRTY_FALSE)
                    || (sector->status.dirty == SECTOR_DIRTY_TRUE && !gc_request))) {
        *empty_env = sector->empty_env;
        return true;
    }

    return false;
}

static uint32_t alloc_env(sector_meta_data_t sector, size_t env_size)
{
    uint32_t empty_env = 0xFFFFFFFF;
    size_t empty_sector = 0, using_sector = 0;


    sector_iterator(sector, SECTOR_STORE_UNUSED, &empty_sector, &using_sector, sector_statistics_cb, false);
    if (using_sector > 0) {

        sector_iterator(sector, SECTOR_STORE_USING, &env_size, &empty_env, alloc_env_cb, true);
    }
    if (empty_sector > 0 && empty_env == 0xFFFFFFFF) {
        if (empty_sector > 1 || gc_request) {
            sector_iterator(sector, SECTOR_STORE_EMPTY, &env_size, &empty_env, alloc_env_cb, true);
        } else {

            ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1069, "Trigger a GC check after alloc ENV failed.\r\n");
            gc_request = true;
        }
    }

    return empty_env;
}

static EfErrCode del_env(const char *key, env_node_obj_t old_env, bool complete_del) {
    EfErrCode result = EF_NO_ERR;
    uint32_t dirty_status_addr;
    static bool last_is_complete_del = false;


    uint8_t status_table[(((ENV_STATUS_NUM - 1) * (1 * 8) + 7)/8)];





    if (!old_env) {
        struct env_node_obj env;

        if (find_env(key, &env)) {
            old_env = &env;
        } else {
            ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1095, "Not found '%s' in ENV.\r\n", key);
            return EF_ENV_NAME_ERR;
        }
    }

    if (!complete_del) {
        result = write_status(old_env->addr.start, status_table, ENV_STATUS_NUM, ENV_PRE_DELETE);
        last_is_complete_del = true;
    } else {
        result = write_status(old_env->addr.start, status_table, ENV_STATUS_NUM, ENV_DELETED);

        if (!last_is_complete_del && result == EF_NO_ERR) {


            if (key != 
# 1109 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                      ((void *)0)
# 1109 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                          ) {

                update_env_cache(key, strlen(key), 0xFFFFFFFF);
            } else if (old_env != 
# 1112 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                 ((void *)0)
# 1112 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                     ) {

                update_env_cache(old_env->name, old_env->name_len, 0xFFFFFFFF);
            }

        }

        last_is_complete_del = false;
    }

    dirty_status_addr = ((old_env->addr.start) & ~(((4096)) - 1)) + ((unsigned long)(&((struct sector_hdr_data *)0)->status_table.dirty));

    if (result == EF_NO_ERR
            && read_status(dirty_status_addr, status_table, SECTOR_DIRTY_STATUS_NUM) == SECTOR_DIRTY_FALSE) {
        result = write_status(dirty_status_addr, status_table, SECTOR_DIRTY_STATUS_NUM, SECTOR_DIRTY_TRUE);
    }

    return result;
}




static EfErrCode move_env(env_node_obj_t env)
{
    EfErrCode result = EF_NO_ERR;
    uint8_t status_table[(((ENV_STATUS_NUM - 1) * (1 * 8) + 7)/8)];
    uint32_t env_addr;
    struct sector_meta_data sector;


    if (env->status == ENV_WRITE) {
        del_env(
# 1144 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
               ((void *)0)
# 1144 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                   , env, false);
    }

    if ((env_addr = alloc_env(&sector, env->len)) != 0xFFFFFFFF) {
        if (in_recovery_check) {
            struct env_node_obj env_bak;
            char name[(64) + 1] = { 0 };
            strncpy(name, env->name, env->name_len);

            if (find_env_no_cache(name, &env_bak)) {

                result = EF_NO_ERR;
                goto __exit;
            }
        }
    } else {
        return EF_ENV_FULL;
    }

    {
        uint8_t buf[32];
        size_t len, size, env_len = env->len;


        update_sec_status(&sector, env->len, 
# 1168 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                            ((void *)0)
# 1168 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                                );

        write_status(env_addr, status_table, ENV_STATUS_NUM, ENV_PRE_WRITE);
        env_len -= ((unsigned long)(&((struct env_hdr_data *)0)->magic));
        for (len = 0, size = 0; len < env_len; len += size) {
            if (len + sizeof(buf) < env_len) {
                size = sizeof(buf);
            } else {
                size = env_len - len;
            }
            ef_port_read(env->addr.start + ((unsigned long)(&((struct env_hdr_data *)0)->magic)) + len, (uint32_t *) buf, ((((size) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
            result = ef_port_write(env_addr + ((unsigned long)(&((struct env_hdr_data *)0)->magic)) + len, (uint32_t *) buf, size);
        }
        write_status(env_addr, status_table, ENV_STATUS_NUM, ENV_WRITE);


        update_sector_cache(((env_addr) & ~(((4096)) - 1)),
                env_addr + (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))) + ((((env->name_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))) + ((((env->value_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
        update_env_cache(env->name, env->name_len, env_addr);

    }

    ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1190, "Moved the ENV (%.*s) from 0x%08X to 0x%08X.\r\n", env->name_len, env->name, env->addr.start, env_addr);

__exit:
    del_env(
# 1193 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
           ((void *)0)
# 1193 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
               , env, true);

    return result;
}

static uint32_t new_env(sector_meta_data_t sector, size_t env_size)
{
    bool already_gc = false;
    uint32_t empty_env = 0xFFFFFFFF;

__retry:

    if ((empty_env = alloc_env(sector, env_size)) == 0xFFFFFFFF && gc_request && !already_gc) {
        ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1206, "Warning: Alloc an ENV (size %d) failed when new ENV. Now will GC then retry.\r\n", env_size);
        gc_collect();
        already_gc = true;
        goto __retry;
    }

    return empty_env;
}

static uint32_t new_env_by_kv(sector_meta_data_t sector, size_t key_len, size_t buf_len)
{
    size_t env_len = (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))) + ((((key_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))) + ((((buf_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)));

    return new_env(sector, env_len);
}

static bool gc_check_cb(sector_meta_data_t sector, void *arg1, [[gnu::unused]] void *arg2)
{
    size_t *empty_sec = arg1;

    if (sector->check_ok) {
        *empty_sec = *empty_sec + 1;
    }

    return false;

}

static bool do_gc(sector_meta_data_t sector, [[gnu::unused]] void *arg1, [[gnu::unused]] void *arg2)
{
    struct env_node_obj env;

    if (sector->check_ok && (sector->status.dirty == SECTOR_DIRTY_TRUE || sector->status.dirty == SECTOR_DIRTY_GC)) {
        uint8_t status_table[(((SECTOR_DIRTY_STATUS_NUM - 1) * (1 * 8) + 7)/8)];

        write_status(sector->addr + ((unsigned long)(&((struct sector_hdr_data *)0)->status_table.dirty)), status_table, SECTOR_DIRTY_STATUS_NUM, SECTOR_DIRTY_GC);

        env.addr.start = 0xFFFFFFFF;
        while ((env.addr.start = get_next_env_addr(sector, &env)) != 0xFFFFFFFF) {
            read_env(&env);
            if (env.crc_is_ok && (env.status == ENV_WRITE || env.status == ENV_PRE_DELETE)) {

                if (move_env(&env) != EF_NO_ERR) {
                    ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1249, "Error: Moved the ENV (%.*s) for GC failed.\r\n", env.name_len, env.name);
                }
            }
        }
        format_sector(sector->addr, 0xFFFFFFFF);
        ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1254, "Collect a sector @0x%08X\r\n", sector->addr);
    }

    return false;
}






static void gc_collect(void)
{
    struct sector_meta_data sector;
    size_t empty_sec = 0;


    sector_iterator(&sector, SECTOR_STORE_EMPTY, &empty_sec, 
# 1271 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                                            ((void *)0)
# 1271 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                                                , gc_check_cb, false);


    ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1274, "The remain empty sector is %d, GC threshold is %d.\r\n", empty_sec, 1);
    if (empty_sec <= 1) {
        sector_iterator(&sector, SECTOR_STORE_UNUSED, 
# 1276 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                                     ((void *)0)
# 1276 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                                         , 
# 1276 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                                           ((void *)0)
# 1276 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                                               , do_gc, false);
    }

    gc_request = false;
}

static EfErrCode align_write(uint32_t addr, const uint32_t *buf, size_t size)
{
    EfErrCode result = EF_NO_ERR;
    size_t align_remain;


    uint8_t align_data[(1 * 8) / 8];
    size_t align_data_size = sizeof(align_data);






    memset(align_data, 0xFF, align_data_size);
    result = ef_port_write(addr, buf, (((size) & ~((((1 * 8) + 7)/8) - 1))));

    align_remain = size - (((size) & ~((((1 * 8) + 7)/8) - 1)));
    if (result == EF_NO_ERR && align_remain) {
        memcpy(align_data, (uint8_t *)buf + (((size) & ~((((1 * 8) + 7)/8) - 1))), align_remain);
        result = ef_port_write(addr + (((size) & ~((((1 * 8) + 7)/8) - 1))), (uint32_t *) align_data, align_data_size);
    }

    return result;
}

static EfErrCode create_env_blob(sector_meta_data_t sector, const char *key, const void *value, size_t len)
{
    EfErrCode result = EF_NO_ERR;
    struct env_hdr_data env_hdr;
    bool is_full = false;
    uint32_t env_addr = sector->empty_env;

    if (strlen(key) > (64)) {
        ef_log_info("Error: The ENV name length is more than %d\r\n", (64));
        return EF_ENV_NAME_ERR;
    }

    memset(&env_hdr, 0xFF, sizeof(struct env_hdr_data));
    env_hdr.magic = 0x3034564B;
    env_hdr.name_len = strlen(key);
    env_hdr.value_len = len;
    env_hdr.len = (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))) + ((((env_hdr.name_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))) + ((((env_hdr.value_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)));

    if (env_hdr.len > (4096) - (((((sizeof(struct sector_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))))) {
        ef_log_info("Error: The ENV size is too big\r\n");
        return EF_ENV_FULL;
    }

    if (env_addr != 0xFFFFFFFF || (env_addr = new_env(sector, env_hdr.len)) != 0xFFFFFFFF) {
        size_t align_remain;

        if (result == EF_NO_ERR) {
            result = update_sec_status(sector, env_hdr.len, &is_full);
        }
        if (result == EF_NO_ERR) {
            uint8_t ff = 0xFF;

            env_hdr.crc32 = ef_calc_crc32(0, &env_hdr.name_len, (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))) - ((unsigned long)(&((struct env_hdr_data *)0)->name_len)));
            env_hdr.crc32 = ef_calc_crc32(env_hdr.crc32, key, env_hdr.name_len);
            align_remain = ((((env_hdr.name_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))) - env_hdr.name_len;
            while (align_remain--) {
                env_hdr.crc32 = ef_calc_crc32(env_hdr.crc32, &ff, 1);
            }
            env_hdr.crc32 = ef_calc_crc32(env_hdr.crc32, value, env_hdr.value_len);
            align_remain = ((((env_hdr.value_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))) - env_hdr.value_len;
            while (align_remain--) {
                env_hdr.crc32 = ef_calc_crc32(env_hdr.crc32, &ff, 1);
            }

            result = write_env_hdr(env_addr, &env_hdr);

        }

        if (result == EF_NO_ERR) {
            result = align_write(env_addr + (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))), (uint32_t *) key, env_hdr.name_len);


            if (!is_full) {
                update_sector_cache(sector->addr,
                        env_addr + (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))) + ((((env_hdr.name_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))) + ((((env_hdr.value_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
            }
            update_env_cache(key, env_hdr.name_len, env_addr);

        }

        if (result == EF_NO_ERR) {
            result = align_write(env_addr + (((((sizeof(struct env_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))) + ((((env_hdr.name_len) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))), value,
                    env_hdr.value_len);
        }

        if (result == EF_NO_ERR) {
            result = write_status(env_addr, env_hdr.status_table, ENV_STATUS_NUM, ENV_WRITE);
        }

        if (result == EF_NO_ERR && is_full) {
            ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1378, "Trigger a GC check after created ENV.\r\n");
            gc_request = true;
        }
    } else {
        result = EF_ENV_FULL;
    }

    return result;
}
# 1395 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
EfErrCode ef_del_env(const char *key)
{
    EfErrCode result = EF_NO_ERR;

    if (!init_ok) {
        ef_log_info("Error: ENV isn't initialize OK.\r\n");
        return EF_ENV_INIT_FAILED;
    }

    if (!key || (strlen(key) > (64))) {
        do { ; bl_printk("[%10u][%s: %s:%4d] " "key = %p\r\n", (xPortIsInsideInterrupt())?(xTaskGetTickCountFromISR()):(xTaskGetTickCount()), "\x1b[33mWARN  \x1b[0m", "ef_env.c", 1405, key); ; } while(0==1);
        return EF_NO_ERR;
    }


    ef_port_env_lock();

    result = del_env(key, 
# 1412 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                         ((void *)0)
# 1412 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                             , true);


    ef_port_env_unlock();

    return result;
}
# 1430 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
EfErrCode ef_del_and_save_env(const char *key)
{
    return ef_del_env(key);
}

static EfErrCode set_env(const char *key, const void *value_buf, size_t buf_len)
{
    EfErrCode result = EF_NO_ERR;
    static struct env_node_obj env;
    static struct sector_meta_data sector;
    bool env_is_found = false;

    if (value_buf == 
# 1442 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                    ((void *)0)
# 1442 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                        ) {
        result = del_env(key, 
# 1443 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                             ((void *)0)
# 1443 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                 , true);
    } else {

        if (new_env_by_kv(&sector, strlen(key), buf_len) == 0xFFFFFFFF) {
            return EF_ENV_FULL;
        }
        env_is_found = find_env(key, &env);

        if (env_is_found) {
            result = del_env(key, &env, false);
        }

        if (result == EF_NO_ERR) {
            result = create_env_blob(&sector, key, value_buf, buf_len);
        }

        if (env_is_found && result == EF_NO_ERR) {
            result = del_env(key, &env, true);
        }

        if (gc_request) {
            gc_collect();
        }
    }

    return result;
}
# 1481 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
EfErrCode ef_set_env_blob(const char *key, const void *value_buf, size_t buf_len)
{
    EfErrCode result = EF_NO_ERR;


    if (!init_ok) {
        ef_log_info("ENV isn't initialize OK.\r\n");
        return EF_ENV_INIT_FAILED;
    }

    if (!key || !value_buf) {
        do { ; bl_printk("[%10u][%s: %s:%4d] " "key = %p, value_buf = %p\r\n", (xPortIsInsideInterrupt())?(xTaskGetTickCountFromISR()):(xTaskGetTickCount()), "\x1b[33mWARN  \x1b[0m", "ef_env.c", 1492, key, value_buf); ; } while(0==1);
        return EF_ENV_ARG_ERR;
    }

    if (strlen(key) > (64)) {
        do { ; bl_printk("[%10u][%s: %s:%4d] " "key err. %d > %d\r\n", (xPortIsInsideInterrupt())?(xTaskGetTickCountFromISR()):(xTaskGetTickCount()), "\x1b[33mWARN  \x1b[0m", "ef_env.c", 1497, strlen(key), (64)); ; } while(0==1);
        return EF_ENV_ARG_ERR;
    }

    if (buf_len > (3980)) {
        do { ; bl_printk("[%10u][%s: %s:%4d] " "buf_len err. %d > %d\r\n", (xPortIsInsideInterrupt())?(xTaskGetTickCountFromISR()):(xTaskGetTickCount()), "\x1b[33mWARN  \x1b[0m", "ef_env.c", 1502, buf_len, (3980)); ; } while(0==1);
        return EF_ENV_ARG_ERR;
    }


    ef_port_env_lock();

    result = set_env(key, value_buf, buf_len);


    ef_port_env_unlock();

    return result;
}
# 1526 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
EfErrCode ef_set_env(const char *key, const char *value)
{
    return ef_set_env_blob(key, value, strlen(value));
}
# 1542 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
EfErrCode ef_set_and_save_env(const char *key, const char *value)
{
    return ef_set_env_blob(key, value, strlen(value));
}






EfErrCode ef_save_env(void)
{

    return EF_NO_ERR;
}






EfErrCode ef_env_set_default(void)
{
    EfErrCode result = EF_NO_ERR;
    uint32_t addr, i, value_len;
    struct sector_meta_data sector;

    if (!(default_env_set)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1569, "(%s) has assert failed at %s.\r\n", "default_env_set", __FUNCTION__); while (1); };
    if (!(default_env_set_size)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1570, "(%s) has assert failed at %s.\r\n", "default_env_set_size", __FUNCTION__); while (1); };


    ef_port_env_lock();

    for (addr = env_start_addr; addr < env_start_addr + (2 * (16384)); addr += (4096)) {
        result = format_sector(addr, 0xFFFFFFFF);
        if (result != EF_NO_ERR) {
            goto __exit;
        }
    }

    for (i = 0; i < default_env_set_size; i++) {


        if (default_env_set[i].value_len == 0) {
            value_len = strlen(default_env_set[i].value);
        } else {
            value_len = default_env_set[i].value_len;
        }
        sector.empty_env = 0xFFFFFFFF;
        create_env_blob(&sector, default_env_set[i].key, default_env_set[i].value, value_len);
        if (result != EF_NO_ERR) {
            goto __exit;
        }
    }

__exit:

    ef_port_env_unlock();

    return result;
}

static bool print_env_cb(env_node_obj_t env, void *arg1, [[gnu::unused]] void *arg2)
{
    bool value_is_str = true, print_value = false;
    size_t *using_size = arg1;

    if (env->crc_is_ok) {

        *using_size += env->len;

        if (env->status == ENV_WRITE) {
            ef_print("%.*s=", env->name_len, env->name);

            if (env->value_len < (3980) ) {
                uint8_t buf[32];
                size_t len, size;
__reload:

                for (len = 0, size = 0; len < env->value_len; len += size) {
                    if (len + sizeof(buf) < env->value_len) {
                        size = sizeof(buf);
                    } else {
                        size = env->value_len - len;
                    }
                    ef_port_read(env->addr.value + len, (uint32_t *) buf, ((((size) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1))));
                    if (print_value) {
                        ef_print("%.*s", size, buf);
                    } else if (!ef_is_str(buf, size)) {
                        value_is_str = false;
                        break;
                    }
                }
            } else {
                value_is_str = false;
            }
            if (value_is_str && !print_value) {
                print_value = true;
                goto __reload;
            } else if (!value_is_str) {
                ef_print("blob @0x%08X %dbytes", env->addr.value, env->value_len);
            }
            ef_print("\r\n");
        }
    }

    return false;
}





void ef_print_env(void)
{
    struct env_node_obj env;
    size_t using_size = 0;

    if (!init_ok) {
        ef_log_info("ENV isn't initialize OK.\r\n");
        return;
    }


    ef_port_env_lock();

    env_iterator(&env, &using_size, 
# 1668 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                   ((void *)0)
# 1668 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                       , print_env_cb);

    ef_print("\r\nmode: next generation\r\n");
    ef_print("size: %lu/%lu bytes.\r\n", using_size + (((2 * (16384)) / ((4096))) - 1) * (((((sizeof(struct sector_hdr_data)) + (((1 * 8) + 7)/8) - 1) & ~((((1 * 8) + 7)/8) - 1)))),
            (2 * (16384)) - (4096) * 1);


    ef_port_env_unlock();
}
# 1717 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
static bool check_sec_hdr_cb(sector_meta_data_t sector, void *arg1, [[gnu::unused]] void *arg2)
{
    if (!sector->check_ok) {
        size_t *failed_count = arg1;

        ef_log_info("Warning: Sector header check failed. Format this sector (0x%08x).\r\n", sector->addr);
        (*failed_count) ++;
        format_sector(sector->addr, 0xFFFFFFFF);
    }

    return false;
}

static bool check_and_recovery_gc_cb(sector_meta_data_t sector, [[gnu::unused]] void *arg1, [[gnu::unused]] void *arg2)
{
    if (sector->check_ok && sector->status.dirty == SECTOR_DIRTY_GC) {

        gc_request = true;

        gc_collect();
    }

    return false;
}

static bool check_and_recovery_env_cb(env_node_obj_t env, [[gnu::unused]] void *arg1, [[gnu::unused]] void *arg2)
{

    if (env->crc_is_ok && env->status == ENV_PRE_DELETE) {
        ef_log_info("Found an ENV (%.*s) which has changed value failed. Now will recovery it.\r\n", env->name_len, env->name);

        if (move_env(env) == EF_NO_ERR) {
            ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1749, "Recovery the ENV successful.\r\n");
        } else {
            ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1751, "Warning: Moved an ENV (size %d) failed when recovery. Now will GC then retry.\r\n", env->len);
            return true;
        }
    } else if (env->status == ENV_PRE_WRITE) {
        uint8_t status_table[(((ENV_STATUS_NUM - 1) * (1 * 8) + 7)/8)];


        write_status(env->addr.start, status_table, ENV_STATUS_NUM, ENV_ERR_HDR);
        return true;
    }

    return false;
}






EfErrCode ef_load_env(void)
{
    EfErrCode result = EF_NO_ERR;
    struct env_node_obj env;
    struct sector_meta_data sector;
    size_t check_failed_count = 0;

    in_recovery_check = true;

    sector_iterator(&sector, SECTOR_STORE_UNUSED, &check_failed_count, 
# 1779 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                                                      ((void *)0)
# 1779 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                                                          , check_sec_hdr_cb, false);

    if (check_failed_count == ((2 * (16384)) / ((4096)))) {
        ef_log_info("Warning: All sector header check failed. Set it to default.\r\n");
        ef_env_set_default();
    }


    ef_port_env_lock();

    sector_iterator(&sector, SECTOR_STORE_UNUSED, 
# 1789 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                                 ((void *)0)
# 1789 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                                     , 
# 1789 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                                                       ((void *)0)
# 1789 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                                           , check_and_recovery_gc_cb, false);

__retry:

    env_iterator(&env, 
# 1793 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                      ((void *)0)
# 1793 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                          , 
# 1793 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c" 3 4
                            ((void *)0)
# 1793 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
                                , check_and_recovery_env_cb);
    if (gc_request) {
        gc_collect();
        goto __retry;
    }

    in_recovery_check = false;


    ef_port_env_unlock();

    return result;
}
# 1815 "/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c"
EfErrCode ef_env_init(ef_env const *default_env, size_t default_env_size) {
    EfErrCode result = EF_NO_ERR;


    size_t i;


    if (!(default_env)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1822, "(%s) has assert failed at %s.\r\n", "default_env", __FUNCTION__); while (1); };
    if (!((2 * (16384)))) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1823, "(%s) has assert failed at %s.\r\n", "ENV_AREA_SIZE", __FUNCTION__); while (1); };

    if (!((2 * (16384)) % (4096) == 0)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1825, "(%s) has assert failed at %s.\r\n", "ENV_AREA_SIZE % EF_ERASE_MIN_SIZE == 0", __FUNCTION__); while (1); };

    if (!(((2 * (16384)) / ((4096))) >= 2)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1827, "(%s) has assert failed at %s.\r\n", "SECTOR_NUM >= 2", __FUNCTION__); while (1); };

    if (!(((3980) * 8) % (1 * 8) == 0)) { ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1829, "(%s) has assert failed at %s.\r\n", "(EF_STR_ENV_VALUE_MAX_SIZE * 8) % EF_WRITE_GRAN == 0", __FUNCTION__); while (1); };

    if (init_ok) {
        return EF_NO_ERR;
    }


    for (i = 0; i < 4; i++) {
        sector_cache_table[i].addr = 0xFFFFFFFF;
    }
    for (i = 0; i < 16; i++) {
        env_cache_table[i].addr = 0xFFFFFFFF;
    }


    env_start_addr = (0);
    default_env_set = default_env;
    default_env_set_size = default_env_size;

    ef_log_debug("/home/chandu/sdk/bl602_iot_sdk/components/stage/easyflash4/src/ef_env.c", 1848, "ENV start address is 0x%08X, size is %d bytes.\r\n", (0), (2 * (16384)));

    result = ef_load_env();







    if (result == EF_NO_ERR) {
        init_ok = true;
    }

    return result;
}
